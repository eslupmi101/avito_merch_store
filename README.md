# Avito Merch Store

## üìå –û–ø–∏—Å–∞–Ω–∏–µ
**Avito Merch Store** ‚Äî —ç—Ç–æ —Å–µ—Ä–≤–∏—Å, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ **Golang** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **–ø–∞—Ç—Ç–µ—Ä–Ω–∞ MVC**. –û–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥–∞–∂–µ–π –º–µ—Ä—á–∞.

## üìã –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Golang** 1.22
- **Python** 3.10
- **Docker**

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

–¢—Ä–µ–±—É–µ–º—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
```sh
8080 5432 
```

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤:
```sh
cp .env.example .env
```

–ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
```sh
docker compose -f docker-compose.yaml up -d
```

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
```sh
make db-script-setup
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢—Ä–µ–±—É–µ–º—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
```sh
5433 5440 8090
```

–ó–∞–ø—É—Å—Ç–∏—Ç—å **—é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã** (–ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã):
```sh
make test-unit
```

–ó–∞–ø—É—Å—Ç–∏—Ç—å **–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**:
```sh
make test-int
```

–ó–∞–ø—É—Å—Ç–∏—Ç—å **–±–µ–Ω—á–º–∞—Ä–∫**:
```sh
make test-bench
```

–ó–∞–ø—É—Å—Ç–∏—Ç—å **–≤—Å–µ —Ç–µ—Å—Ç—ã**:
```sh
make test-all
```

# üìä  –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–Ω—á–º–∞—Ä–∫–æ–≤

## üîπ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
* üìå –ó–∞–ø—Ä–æ—Å–æ–≤: 1000
* ‚è± –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 23178.90 ms
* üìä 99-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å: 28181.32 ms
* ‚ùå –£—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: 60.50%
* üöÄ –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: 1000.93 RPS

* ‚ùå –û—à–∏–±–∫–∞: –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –Ω–∏–∂–µ 99.99%
* ‚ùå –û—à–∏–±–∫–∞: –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ P99 –±–æ–ª—å—à–µ 50 –º—Å

* ‚õî FAIL: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

## üîπ –ü–æ–∫—É–ø–∫–∞ –º–µ—Ä—á–∞ (/api/buy/{merchName})
* üìå –ó–∞–ø—Ä–æ—Å–æ–≤: 1000
* ‚è± –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 0.95 ms
* üìä 99-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å: 2.10 ms
* ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: 98.70%
* üöÄ –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: 1001.12 RPS

* ‚ùå –û—à–∏–±–∫–∞: –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –Ω–∏–∂–µ 99.99%
* ‚úÖ –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ‚â§ 50 –º—Å

* ‚õî FAIL: –ü–æ–∫—É–ø–∫–∞ –º–µ—Ä—á–∞

## üîπ –ü—Ä–æ—Ñ–∏–ª—å —é–∑–µ—Ä–∞ (/api/info)
* üìå –ó–∞–ø—Ä–æ—Å–æ–≤: 1000
* ‚è± –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 1.86 ms
* üìä 99-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å: 3.42 ms
* ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: 100.00%
* üöÄ –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: 1001.13 RPS

* ‚úÖ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –≤—ã—à–µ 99.99%
* ‚úÖ –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ‚â§ 50 –º—Å

* üéâ ‚úÖ PASS: –ü—Ä–æ—Ñ–∏–ª—å —é–∑–µ—Ä–∞

## üîπ –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–∏–Ω–æ–≤ (/api/sendCoin)
* üìå –ó–∞–ø—Ä–æ—Å–æ–≤: 1000
* ‚è± –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 1.57 ms
* üìä 99-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å: 20.26 ms
* ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: 100.00%
* üöÄ –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: 1001.10 RPS

* ‚úÖ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –≤—ã—à–µ 99.99%
* ‚úÖ –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ‚â§ 50 –º—Å

* üéâ ‚úÖ PASS: –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–∏–Ω–æ–≤

# üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üõ† –¢–∞–±–ª–∏—Ü–∞ `users`
| –ü–æ–ª–µ      | –¢–∏–ø             | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è                                      | –û–ø–∏—Å–∞–Ω–∏–µ                   |
|-----------|----------------|--------------------------------------------------|----------------------------|
| `id`      | `SERIAL`        | `PRIMARY KEY`                                   | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä  |
| `username`| `VARCHAR(100)`  | `NOT NULL UNIQUE`                               | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–Ω–∏–∫.)   |
| `password`| `TEXT`          | `NOT NULL`                                      | –ü–∞—Ä–æ–ª—å                     |
| `balance` | `INT`           | `NOT NULL DEFAULT 0 CHECK (0 ‚â§ balance ‚â§ 100M)` | –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è        |

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_users_username` (`username`)
- `idx_users_id` (`id`)

---

## üéÅ –¢–∞–±–ª–∏—Ü–∞ `merch`
| –ü–æ–ª–µ   | –¢–∏–ø            | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è                           | –û–ø–∏—Å–∞–Ω–∏–µ       |
|--------|---------------|---------------------------------------|---------------|
| `id`   | `SERIAL`       | `PRIMARY KEY`                        | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID |
| `name` | `VARCHAR(200)` | `NOT NULL UNIQUE`                    | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ |
| `price`| `INT`          | `NOT NULL CHECK (0 < price ‚â§ 100M)` | –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ |

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_merch_name` (`name`)

---

## üí∞ –¢–∞–±–ª–∏—Ü–∞ `transactions`
| –ü–æ–ª–µ       | –¢–∏–ø     | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è                                | –û–ø–∏—Å–∞–Ω–∏–µ            |
|------------|--------|------------------------------------------|---------------------|
| `id`       | `SERIAL` | `PRIMARY KEY`                           | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID      |
| `sender`   | `INT`    | `NOT NULL REFERENCES users(id) ON DELETE CASCADE` | –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å      |
| `recipient`| `INT`    | `NOT NULL REFERENCES users(id) ON DELETE CASCADE` | –ü–æ–ª—É—á–∞—Ç–µ–ª—å       |
| `amount`   | `INT`    | `NOT NULL CHECK (0 < amount ‚â§ 100M)`    | –°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞    |

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_transactions_sender` (`sender`)
- `idx_transactions_recipient` (`recipient`)

---

## üõç –¢–∞–±–ª–∏—Ü–∞ ManyToMany `merch_orders`
| –ü–æ–ª–µ    | –¢–∏–ø     | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è                                    | –û–ø–∏—Å–∞–Ω–∏–µ        |
|---------|--------|----------------------------------------------|---------------|
| `id`    | `SERIAL` | `PRIMARY KEY`                               | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID |
| `owner` | `INT`    | `NOT NULL REFERENCES users(id) ON DELETE CASCADE` | –í–ª–∞–¥–µ–ª–µ—Ü –∑–∞–∫–∞–∑–∞ |
| `merch` | `INT`    | `NOT NULL REFERENCES merch(id) ON DELETE CASCADE` | –ó–∞–∫–∞–∑–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä |

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_merch_orders_owner` (`owner`)
